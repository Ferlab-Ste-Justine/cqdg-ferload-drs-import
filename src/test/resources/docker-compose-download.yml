version: "3"
services:
  auth:
    image: quay.io/keycloak/keycloak
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
      KC_HTTP_PORT: 7000 # 8080 will clash with keycloak
    command:
      - start-dev

  ferload:
    build: .
    ports:
      - "9090:9090"
    environment:
      AUTH_CLIENT_ID: "cqdg-resource-server"
      AUTH_CLIENT_SECRET: "SECRET"
      AUTH_REALM: "CQDG"
      AUTH_URL: "http://auth:7000"
      DRS_ID: "user1"
      DRS_NAME: "DRS_NAME"
      DRS_ORGANIZATION_NAME: "DRS_ORGANIZATION_NAME"
      DRS_ORGANIZATION_URL: "DRS_ORGANIZATION_URL"
      DRS_SELF_HOST: "DRS_SELF_HOST"
      FERLOAD_CLIENT_CLIENT_ID: "user1"
      FERLOAD_CLIENT_METHOD: "password"
      AWS_ACCESS_KEY: "minioadmin"
      AWS_SECRET_KEY: "minioadmin"
      AWS_ENDPOINT: "http://minio:9000"
      AWS_PATH_ACCESS_STYLE: "true"
      AWS_REGION: "us-est-1"

  minio:
    image: minio/minio
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
#    ports:
#      - "9001:9001"
    volumes:
      - ./data:/data
#    command: server --console-address :9001 /data
    command: server /data